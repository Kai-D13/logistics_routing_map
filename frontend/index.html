<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logistics Routing System - Qu·∫£n l√Ω Tuy·∫øn ƒê∆∞·ªùng</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1>üöö Logistics Routing System</h1>
            <p>H·ªá th·ªëng qu·∫£n l√Ω tuy·∫øn ƒë∆∞·ªùng v·∫≠n chuy·ªÉn</p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel">
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon">üè†</div>
                    <div class="stat-info">
                        <h3 id="departer-count">0</h3>
                        <p>Hub Ch√≠nh</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìç</div>
                    <div class="stat-info">
                        <h3 id="destination-count">0</h3>
                        <p>ƒêi·ªÉm Giao H√†ng</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üöö</div>
                    <div class="stat-info">
                        <h3 id="trip-count">0</h3>
                        <p>Chuy·∫øn ƒêi</p>
                    </div>
                </div>
            </div>

            <!-- Feature Tabs -->
            <div class="feature-tabs">
                <button class="tab-btn active" data-tab="map">üó∫Ô∏è B·∫£n ƒê·ªì</button>
                <button class="tab-btn" data-tab="routes">üìã Qu·∫£n L√Ω Routes</button>
                <button class="tab-btn" data-tab="vrp">üöÄ T·ªëi ∆Øu VRP</button>
            </div>

            <!-- Tab Contents -->
            <div class="tab-content active" id="map-tab">
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="openAddDeparterModal()">
                        <span>‚ûï</span> Th√™m Hub Ch√≠nh
                    </button>
                    <button class="btn btn-success" onclick="openAddDestinationModal()">
                        <span>‚ûï</span> Th√™m ƒêi·ªÉm Giao H√†ng
                    </button>
                    <button class="btn btn-warning" onclick="openCalculateDistanceModal()">
                        <span>üìè</span> T√≠nh Kho·∫£ng C√°ch
                    </button>
                    <button class="btn btn-info" onclick="refreshMap()">
                        <span>üîÑ</span> L√†m M·ªõi
                    </button>
                </div>
            </div>

            <div class="tab-content" id="routes-tab">
                <div class="routes-panel">
                    <h3>üîç T√¨m Ki·∫øm Route</h3>
                    <div class="form-group">
                        <label for="route-select">Ch·ªçn Route:</label>
                        <select id="route-select" class="form-control">
                            <option value="">-- Ch·ªçn Route --</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="vrp-tab">
                <div class="vrp-panel">
                    <h3>üöÄ T·ªëi ∆Øu Tuy·∫øn ƒê∆∞·ªùng (VRP)</h3>

                    <div class="form-group">
                        <label for="vrp-departer-select">ƒêi·ªÉm Xu·∫•t Ph√°t:</label>
                        <select id="vrp-departer-select" class="form-control">
                            <option value="">-- Ch·ªçn ƒëi·ªÉm xu·∫•t ph√°t --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Ch·ªçn ƒêi·ªÉm ƒê·∫øn:</label>
                        <div class="destinations-actions">
                            <button id="select-all-destinations" class="btn btn-sm">Ch·ªçn t·∫•t c·∫£</button>
                            <button id="deselect-all-destinations" class="btn btn-sm">B·ªè ch·ªçn</button>
                        </div>
                        <div id="vrp-destinations-list" class="destinations-list"></div>
                    </div>

                    <div class="vrp-actions">
                        <button id="calculate-route-btn" class="btn btn-success">
                            üìè T√≠nh Kho·∫£ng C√°ch
                        </button>
                        <button id="optimize-route-btn" class="btn btn-primary">
                            üöÄ T·ªëi ∆Øu Tuy·∫øn ƒê∆∞·ªùng
                        </button>
                        <button id="clear-vrp-btn" class="btn btn-secondary">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Container -->
        <div class="map-container">
            <div id="map"></div>
        </div>

        <!-- Locations List -->
        <div class="locations-panel">
            <h2>üìã Danh S√°ch ƒêi·ªÉm Giao H√†ng</h2>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="üîç T√¨m ki·∫øm theo t√™n, t·ªânh..." onkeyup="filterLocations()">
            </div>
            <div id="locations-list" class="locations-list">
                <!-- Locations will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modal: Add Departer -->
    <div id="departerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Th√™m Hub Ch√≠nh</h2>
                <span class="close" onclick="closeDeparterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="departerForm" onsubmit="submitDeparter(event)">
                    <div class="form-group">
                        <label for="departer-name">T√™n Hub *</label>
                        <input type="text" id="departer-name" required placeholder="VD: Hub Ch√≠nh H√† N·ªôi">
                    </div>
                    <div class="form-group">
                        <label for="departer-address">ƒê·ªãa Ch·ªâ *</label>
                        <input type="text" id="departer-address" required placeholder="VD: 123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ">
                        <small>ƒê·ªãa ch·ªâ s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông geocode ƒë·ªÉ l·∫•y t·ªça ƒë·ªô</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeDeparterModal()">H·ªßy</button>
                        <button type="submit" class="btn btn-primary">Th√™m Hub</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Add Destination -->
    <div id="destinationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Th√™m ƒêi·ªÉm Giao H√†ng</h2>
                <span class="close" onclick="closeDestinationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="destinationForm" onsubmit="submitDestination(event)">
                    <div class="form-group">
                        <label for="destination-carrier">T√™n Carrier *</label>
                        <input type="text" id="destination-carrier" required placeholder="VD: NVCT Hub H√† N·ªôi">
                    </div>
                    <div class="form-group">
                        <label for="destination-address">ƒê·ªãa Ch·ªâ *</label>
                        <input type="text" id="destination-address" required placeholder="VD: 456 ƒê∆∞·ªùng DEF">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destination-ward">Ph∆∞·ªùng/X√£</label>
                            <input type="text" id="destination-ward" placeholder="VD: Ph∆∞·ªùng 1">
                        </div>
                        <div class="form-group">
                            <label for="destination-district">Qu·∫≠n/Huy·ªán</label>
                            <input type="text" id="destination-district" placeholder="VD: Qu·∫≠n 1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="destination-province">T·ªânh/Th√†nh Ph·ªë *</label>
                        <input type="text" id="destination-province" required placeholder="VD: Th√†nh ph·ªë H√† N·ªôi">
                    </div>
                    <div class="form-group">
                        <label for="destination-departer">Hub Ch√≠nh *</label>
                        <select id="destination-departer" required>
                            <option value="">-- Ch·ªçn Hub Ch√≠nh --</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeDestinationModal()">H·ªßy</button>
                        <button type="submit" class="btn btn-success">Th√™m ƒêi·ªÉm Giao H√†ng</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Location Details -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="details-title">üìç Chi Ti·∫øt</h2>
                <span class="close" onclick="closeDetailsModal()">&times;</span>
            </div>
            <div class="modal-body" id="details-body">
                <!-- Details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modal: Calculate Distance Between Two Points -->
    <div id="calculateDistanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìè T√≠nh Kho·∫£ng C√°ch Gi·ªØa 2 ƒêi·ªÉm</h2>
                <span class="close" onclick="closeCalculateDistanceModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="calculateDistanceForm" onsubmit="submitCalculateDistance(event)">
                    <div class="form-group">
                        <label for="origin-location">ƒêi·ªÉm Xu·∫•t Ph√°t *</label>
                        <select id="origin-location" required>
                            <option value="">-- Ch·ªçn ƒëi·ªÉm xu·∫•t ph√°t --</option>
                        </select>
                        <small>Ch·ªçn Hub ho·∫∑c ƒëi·ªÉm giao h√†ng l√†m ƒëi·ªÉm xu·∫•t ph√°t</small>
                    </div>

                    <div class="form-group">
                        <label for="destination-location">ƒêi·ªÉm ƒê·∫øn *</label>
                        <select id="destination-location" required>
                            <option value="">-- Ch·ªçn ƒëi·ªÉm ƒë·∫øn --</option>
                        </select>
                        <small>Ch·ªçn Hub ho·∫∑c ƒëi·ªÉm giao h√†ng l√†m ƒëi·ªÉm ƒë·∫øn</small>
                    </div>

                    <div class="form-group">
                        <label for="vehicle-type">Ph∆∞∆°ng Ti·ªán</label>
                        <select id="vehicle-type">
                            <option value="truck" selected>üöö Xe T·∫£i (Truck)</option>
                            <option value="car">üöó Xe H∆°i (Car)</option>
                            <option value="bike">üèçÔ∏è Xe M√°y (Bike)</option>
                        </select>
                    </div>

                    <!-- Result Display -->
                    <div id="distance-result" class="distance-result" style="display: none;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üìä K·∫øt Qu·∫£</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-icon">üõ£Ô∏è</div>
                                <div class="result-info">
                                    <p class="result-label">Kho·∫£ng C√°ch</p>
                                    <p class="result-value" id="result-distance">-</p>
                                </div>
                            </div>
                            <div class="result-item">
                                <div class="result-icon">‚è±Ô∏è</div>
                                <div class="result-info">
                                    <p class="result-label">Th·ªùi Gian</p>
                                    <p class="result-value" id="result-duration">-</p>
                                </div>
                            </div>
                            <div class="result-item">
                                <div class="result-icon">üöö</div>
                                <div class="result-info">
                                    <p class="result-label">Ph∆∞∆°ng Ti·ªán</p>
                                    <p class="result-value" id="result-vehicle">-</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCalculateDistanceModal()">ƒê√≥ng</button>
                        <button type="submit" class="btn btn-warning">üîç T√≠nh To√°n</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>ƒêang x·ª≠ l√Ω...</p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Route Details Panel -->
    <div id="route-details-panel" class="side-panel">
        <div class="side-panel-header">
            <h3>üìã Chi Ti·∫øt Route</h3>
            <button id="close-route-details" class="close-btn">&times;</button>
        </div>
        <div class="side-panel-content">
            <div id="trip-info" class="trip-info"></div>
            <h4 style="margin-top: 20px; margin-bottom: 10px;">üìç Timeline Giao H√†ng</h4>
            <div id="destinations-timeline"></div>
        </div>
    </div>

    <!-- VRP Result Panel -->
    <div id="vrp-result-panel" class="side-panel">
        <div class="side-panel-header">
            <h3>üöÄ K·∫øt Qu·∫£ T·ªëi ∆Øu</h3>
            <button id="close-vrp-result" class="close-btn">&times;</button>
        </div>
        <div class="side-panel-content">
            <div id="vrp-route-info"></div>
            <h4 style="margin-top: 20px; margin-bottom: 10px;">üìç L·ªô Tr√¨nh</h4>
            <div id="vrp-route-steps"></div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Leaflet Polyline Decorator (for arrows) -->
    <script src="https://unpkg.com/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.js"></script>

    <!-- Custom JS -->
    <script src="js/api.js"></script>
    <script src="js/map.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/routes.js"></script>
    <script src="js/vrp.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

